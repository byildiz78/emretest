DECLARE @startDate DATETIME;set @startDate=GETDATE();
IF DATEPART(hour,@startDate)<6
 set @startDate=DATEADD(dd, -1, DATEDIFF(dd, 0, @startDate))
ELSE
set @startDate=DATEADD(dd, 0, DATEDIFF(dd, 0, @startDate))
SELECT b.BranchName AS Şube, m.MenuItemID AS [Ürün Kodu], m.MenuItemText AS [Ürün Adı], mg.MenuGroupText AS Grubu, 
 mc.MenuCategoryText AS Kategorisi, t.MenuItemUnitPrice AS [Birim Fiyat], SUM(t.Quantity) AS Miktar
FROM OrderHeaders AS h INNER JOIN
 OrderTransactions AS t ON h.BranchID = t.BranchID AND h.OrderID = t.OrderID LEFT OUTER JOIN
 efr_Branchs AS b ON t.BranchID = b.BranchID LEFT OUTER JOIN
 MenuGroups AS mg RIGHT OUTER JOIN
 MenuItems AS m ON mg.BranchID = m.BranchID AND mg.MenuGroupID = m.MenuGroupID LEFT OUTER JOIN
 MenuCategories AS mc ON m.MenuCategoryID = mc.MenuCategoryID AND m.BranchID = mc.BranchID ON t.MenuItemID = m.MenuItemID AND 
 t.BranchID = m.BranchID
WHERE (h.OrderDateTime >= @startDate) AND t.@BranchID AND (t.TransactionStatus = '1') AND h.OrderStatus<>'3'
GROUP BY b.BranchName, m.MenuItemID, m.MenuItemText, mg.MenuGroupText, mc.MenuCategoryText, t.MenuItemUnitPrice