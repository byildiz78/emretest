with combos as(
select DISTINCT ComboMenuItemKey,ExtendedMenuName from newGlobalMenuComboItems
)


select b.BranchName as [Şube],t.MenuItemText as [Menü],cmi.ExtendedMenuName as [Combo Adı],SUM(t.Quantity) as [Menü Miktar]
,t.ExtendedPrice as [Menü Tutar],t1.MenuItemText as [Ürün],SUM(t1.Quantity) as [Ürün Miktar],t1.ExtendedPrice as [Ürün Tutar] from OrderTransactions t
INNER JOIN OrderTransactions t1 on t1.MainMenuItemTransactionKey=t.TransactionKey
INNER JOIN efr_Branchs b on b.BranchID=t1.BranchID
LEFT JOIN NewGlobalMenuItems mi on mi.MenuItemKey=t.MenuItemKey
LEFT JOIN combos cmi on cmi.ComboMenuItemKey=mi.MenuItemPopUpChoiceText
where t1.MainMenuItemTransactionKey IS NOT NULL
AND t.OrderDateTime >= convert(varchar, CONVERT(DATETIME,@date1), 23) +' 11:00:00'
AND t.OrderDateTime<= convert(varchar, CONVERT(DATETIME,@date2), 23) +' 14:00:00'
AND t.LineDeleted=0 
AND t.@BranchID
GROUP BY b.BranchName,t.MenuItemText,cmi.ExtendedMenuName,t.ExtendedPrice,t1.MenuItemText,t1.ExtendedPrice