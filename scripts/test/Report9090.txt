SELECT isnull(b.BranchName,'-') AS Şube, r.GUN,ROUND(SUM(r.[Brüt Satışlar]), 2) AS [Brüt Satışlar], ROUND(SUM(r.[Ürün İndirimleri]), 2) AS [Ürün İndirimleri], ROUND(SUM(r.[Nakit İndirimler]), 2) AS 
 [Nakit İndirimler], ROUND(SUM(r.[Çek İndirimler]), 2) AS [Çek İndirimler], SUM(r.[Toplam Indirimler]) AS [Toplam Indirimler], ROUND(SUM(r.[Net Satışlar]), 2) AS 
 [Net Satışlar], COUNT(r.[Toplam Çek Sayısı]) AS [Toplam Çek Sayısı], SUM(r.[Toplam Konuk]) AS [Toplam Konuk], round((SUM(r.[Net Satışlar]) / NULLIF(SUM(r.[Toplam Konuk]), 0)),3) AS 
 [Kişi Başı Ortalama],ROUND(( SUM(r.[Net Satışlar]) / NULLIF(COUNT(r.[Toplam Çek Sayısı]), 0)),3) AS [Çek Ortalama], r.BranchID
FROM (
 SELECT h.amountdue + h.discountTotalAmount AS [Brüt Satışlar], h.DiscountLineAmount AS [Ürün İndirimleri], h.DiscountCashAmount AS 
 [Nakit İndirimler], h.DiscountOrderAmount AS [Çek İndirimler], h.DiscountTotalAmount AS [Toplam Indirimler], h.amountdue AS 
 [Net Satışlar], h.OrderID AS [Toplam Çek Sayısı], h.GuestNumber AS [Toplam Konuk], h.amountdue / ISNULL(h.GuestNumber, 1) AS 
 [Kişi Başı Ortalama], h.amountdue / ISNULL(h.orderID, 1) AS [Çek Ortalama], CONVERT(VARCHAR, DATEADD(hour, -6, h.OrderDateTime), 103) AS 
 GUN, h.amountdue AS [GÜNLÜK TUTAR], h.BranchID
 FROM OrderHeaders h WITH (NOLOCK)
 WHERE h.LineDeleted = 0 AND h.OrderDateTime >= DATEADD(hour, 0, @date1) AND h.OrderDateTime <= DATEADD(hour, 0, @date2) AND h.@BranchID
 ) AS r 
LEFT OUTER JOIN efr_Branchs AS b ON b.BranchID = r.BranchID
GROUP BY r.BranchID,r.GUN,b.BranchName