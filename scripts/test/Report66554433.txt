Detail|
DECLARE @total DECIMAL(18,2)

 SELECT @total= SUM(t.ExtendedPrice) FROM OrderTransactions AS t WITH(NOLOCK)
 WHERE 
 t.LineDeleted=0
 AND t.OrderDateTime >= @date1
 AND t.OrderDateTime <= @date2
  
 --AND t.BranchID=4
 AND t.@BranchID

SELECT 
r.Sıra,

r.[Ürün Adı], 
r.Grubu, 
r.Adet,
r.Tutar,
round(isnull((r.Tutar * 100/NULLIF(@total,0)),0),3) AS [Satış İçindeki Yüzde]
FROM(
SELECT 
p.CustomField10 as [Sıra],

t.MenuItemText AS [Ürün Adı],
t.MenuItemGroupText AS Grubu, 
SUM(t.Quantity) AS Adet,
SUM(t.ExtendedPrice) AS Tutar
FROM OrderTransactions AS t WITH (NOLOCK)
INNER JOIN posproducts  AS p on p.ProductKey=t.MenuItemKey
WHERE t.LineDeleted = 0
AND t.OrderDateTime >= @date1 
AND t.OrderDateTime <=@date2 
--AND t.BranchID=4
AND t.@BranchID
GROUP BY t.MenuItemText, t.MenuItemGroupText,p.customfield10
) AS r
Order By r.[Ürün Adı]
