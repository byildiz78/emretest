DECLARE @ciro FLOAT

SET @ciro=(SELECT SUM(h.AmountDue) AS reportValue
FROM OrderHeaders AS h WITH(NOLOCK)
WHERE h.OrderDateTime BETWEEN @date1 AND @date2
and h.OrderType <> 5
AND h.@BranchID
AND h.linedeleted=0
)

SELECT 
ROUND(SUM(t.ExtendedPrice * isnull(nullif(h.AmountDue,0),1) / isnull(nullif(h.SubTotal,0),1) ), 2) AS reportValue,
ROUND((SUM(t.ExtendedPrice * isnull(nullif(h.AmountDue,0),1) / isnull(nullif(h.SubTotal,0),1))/ @ciro)*100, 2) reportValue3
FROM OrderTransactions AS t WITH(NOLOCK)
INNER JOIN OrderHeaders AS h WITH (NOLOCK) ON h.OrderKey = t.OrderKey
INNER JOIN posProducts as m WITH (NOLOCK) on m.ProductKey=t.MenuItemKey
WHERE t.OrderDateTime BETWEEN @date1 AND @date2
and t.@BranchID    
AND t.LineDeleted=0
and h.OrderType <> 5
AND h.linedeleted=0
AND ISNULL(m.CustomField12,'')='YAN ÜRÜNLER'