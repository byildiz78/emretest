SELECT ( ROW_NUMBER() OVER(ORDER BY ProductName ASC) ) AS AutoID, * FROM 
(
	SELECT 
		pc.PickValue AS [Kategori],
		pg.PickValue AS [Grubu],
		p.ProductCode AS [Stok Kodu],
		d.ProductName AS [Stok Adı],
		dt.TypeName AS [Belge Tipi],
		h.OrderSerialNo AS [Belge Seri Numarası],
		d.Incoming AS [Giren Miktar],
		d.Outgoing AS [Çıkan Miktar],
		d.UnitPrice AS [Birmi Fiyat],
		w.WarehouseName AS [Depo Adı],
		pu.UnitName AS [Birim],
		h.DocumentDateTime AS [Belge Tarih],
		ISNULL(c.CurrentName, '') AS [Cari Adı],
		w2.WarehouseName AS [Hedef Depo],
		d.Incoming * UnitPrice * (1 -ISNULL(d.DiscountPercent, 0) / 100) AS [Giren Tutar İsk. Dahil],
		d.Outgoing * UnitPrice * (1 -ISNULL(d.DiscountPercent, 0) / 100) AS [Çıkan Tutar İsk. Dahil],
		d.Incoming * UnitPrice * (1 -ISNULL(d.DiscountPercent, 0) / 100) * (1 + (ISNULL(d.taxpercent1, 0) / 100)) AS [Giren Tutar İsk. Kdv Dahil],
		d.Outgoing * UnitPrice * (1 -ISNULL(d.DiscountPercent, 0) / 100) * (1 + (ISNULL(d.taxpercent1, 0) / 100)) AS [Çıkan Tutar İsk. Kdv Dahil]
	FROM posWarehouse w
		RIGHT JOIN posOrderDetail d ON w.WarehouseID = d.WarehouseID
		LEFT JOIN posProductUnits pu ON d.UnitID = pu.UnitID
		LEFT JOIN posDocumentTypes dt ON d.DocumentTypeID = dt.DocumentTypeID
		LEFT JOIN posWarehouse w2 ON d.TargetWarehouseID = w2.WarehouseID
		LEFT JOIN posOrderHeader h ON d.OrderID = h.OrderID
		LEFT JOIN posCurrents c ON h.CurrentID = c.CurrentID
		INNER JOIN posProducts p ON p.ProductID = d.ProductID
		INNER JOIN posPickList pg ON pg.ListID = p.GroupID
		INNER JOIN posPickList pc ON pc.ListID = p.CategoryID
	WHERE 
		h.DocumentDateTime>=@date1 and h.DocumentDateTime<=@date2
		AND ISNULL(h.IsConverted, 0) = 0 
        AND w.WarehouseID=@WarehouseID
        AND d.DocumentTypeID IN (3,5)

) AS t