SELECT
	H.OrderKey,
	H.OrderID as [Çek No],
	b.BranchID,
	b.BranchName as [Şube],
	H.OrderDateTime as [Tarih],
	H.AmountDue as [Çek Tutarı]
FROM
	OrderHeaders H
LEFT JOIN OrderPayments T ON T.OrderKey = H.OrderKey AND T.LineDeleted=0
inner join efr_Branchs b on h.BranchID=b.branchID
WHERE
	1 = 1
	AND H.OrderDateTime BETWEEN @startDate AND @endDate
	AND H.LineDeleted = 0
	AND H.OrderStatus = 2
	AND H.AmountDue > 0
	AND b.@BranchID
GROUP BY 
	H.OrderKey, H.OrderID, H.BranchID, H.OrderDateTime,H.AmountDue,b.BranchName,b.BranchID
HAVING 
	COUNT(T.AutoID) = 0;