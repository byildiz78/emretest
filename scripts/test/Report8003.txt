WITH sonuc1 AS 
(SELECT t.BranchID,t.MenumItemCategoryText,SUM(t.Quantity) AS Adet
FROM OrderTransactions AS t WITH (NOLOCK) WHERE t.OrderDateTime>@date1 AND t.OrderDateTime<@date2 AND t.@BranchID
AND t.LineDeleted=0
GROUP BY t.BranchID,t.MenumItemCategoryText)
SELECT isnull(sonuc1.MenumItemCategoryText,sonuc2.MenumItemCategoryText) AS [Kategori Adı], isnull(sonuc1.Adet,0) AS [@bname1],isnull(sonuc2.Adet,0) AS [@bname2]
FROM (
SELECT t.BranchID,t.MenumItemCategoryText,SUM(t.Quantity) AS Adet
FROM OrderTransactions AS t WITH (NOLOCK)
WHERE t.OrderDateTime>@date3 AND t.OrderDateTime<@date4 AND t.@Branch2 AND t.LineDeleted=0
GROUP BY t.BranchID,t.MenumItemCategoryText) AS sonuc2
LEFT OUTER JOIN sonuc1 ON sonuc1.MenumItemCategoryText=sonuc2.MenumItemCategoryText
LEFT OUTER JOIN efr_Branchs AS b1 ON b1.BranchID = sonuc1.BranchID
LEFT OUTER JOIN efr_Branchs AS b2 ON b2.BranchID = sonuc2.BranchID
ORDER BY [Kategori Adı]