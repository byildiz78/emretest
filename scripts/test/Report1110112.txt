


SELECT r.BranchName AS BranchName, SUM(r.KG) AS KG FROM (
SELECT SUM(t.Quantity) * ISNULL(MenuItems.Barcode2, 1) AS KG,
 efr_Branchs.BranchName
FROM OrderTransactions AS t
 LEFT OUTER JOIN MenuItems
 ON t.BranchID = MenuItems.BranchID
 AND t.MenuItemKey = MenuItems.MenuItemKey
 RIGHT OUTER JOIN efr_Branchs
 ON t.BranchID = efr_Branchs.BranchID
WHERE  (t.LineDeleted = 0)
       AND (ISNULL(MenuItems.Barcode2, 0) > 1)
  AND t.OrderDateTime >= @date1
     AND t.OrderDateTime <= @date2
   AND t.@BranchID
AND MenuItems.@BranchID
GROUP BY MenuItems.Barcode2,efr_Branchs.BranchName
 ) AS r GROUP BY r.BranchName
       