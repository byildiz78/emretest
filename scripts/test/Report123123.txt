DECLARE @ciro DECIMAL(18,2)

SELECT 
	@ciro=ROUND(SUM( h.AmountDue ),2)
FROM
	OrderHeaders AS h WITH ( NOLOCK ) 
WHERE
	h.OrderDateTime BETWEEN @date1 AND @date2	
	AND h.LineDeleted=0


select [Combo Menü],Ciro,ROUND((Ciro*100)/@ciro,2) as Oran (Yüzde) from (
select combo.MenuItemText as [Combo Menü],ROUND(SUM(item.ExtendedPrice * isnull(nullif(h.AmountDue,0),1) / isnull(nullif(h.SubTotal,0),1) ), 2) as Ciro from OrderTransactions combo with(nolock)
INNER JOIN OrderTransactions item  on item.MainMenuItemTransactionKey=combo.TransactionKey
INNER JOIN OrderHeaders h on h.OrderKey=combo.OrderKey
where 1=1
AND combo.OrderDateTime BETWEEN @date1 and @date2
and combo.IsMainCombo=1
AND combo.LineDeleted=0
AND h.LineDeleted=0
AND item.LineDeleted=0
GROUP BY combo.MenuItemText) AS TABLO