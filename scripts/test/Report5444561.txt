SELECT br.BranchName as 
[Şube],COUNT(1) as [TOPLAM PAKET ADET],
ROUND( SUM(AmountDue),2) [GENEL TOPLAM CİRO], 

--CASE WHEN h.OrderType=5 THEN SUM(h.AmountDue) ELSE 0 END [TOPLAM PAKET SERVİS CİRO],

SUM(CASE WHEN OrderTypeSourceExternalNo LIKE '%sepet%' THEN 1 ELSE 0 END) [YEMEK SEPETİ ADET],
ROUND(SUM(CASE WHEN OrderTypeSourceExternalNo LIKE '%sepet%' THEN h.AmountDue ELSE 0 END),2) [YEMEK SEPETİ CİRO],


SUM(CASE WHEN OrderTypeSourceExternalNo LIKE '%web%' and OrderSource=3 THEN 1 ELSE 0 END) [WEB SİPARİŞ ADET],
ROUND(SUM(CASE WHEN OrderTypeSourceExternalNo LIKE '%web%' and OrderSource=3 THEN h.AmountDue ELSE 0 END),2) [WEB SİPARİŞ CİRO],

SUM(CASE WHEN OrderTypeSourceExternalNo LIKE '%web%' and OrderSource=4 THEN 1 ELSE 0 END) [ÇM SİPARİŞ ADET],
ROUND(SUM(CASE WHEN OrderTypeSourceExternalNo LIKE '%web%' and OrderSource=4 THEN h.AmountDue ELSE 0 END),2) [ÇM SİPARİŞ CİRO],

SUM(CASE WHEN OrderTypeSourceExternalNo LIKE '%getir%'  THEN 1 ELSE 0 END) [GETİR SİPARİŞ ADET],
ROUND(SUM(CASE WHEN OrderTypeSourceExternalNo LIKE '%getir%' THEN h.AmountDue ELSE 0 END),2) [GETİR SİPARİŞ CİRO],

SUM(CASE WHEN OrderTypeSourceExternalNo LIKE '%trendyol%' THEN 1 ELSE 0 END) [TRENDYOL SİPARİŞ ADET],
ROUND(SUM(CASE WHEN OrderTypeSourceExternalNo LIKE '%trendyol%' THEN h.AmountDue ELSE 0 END),2) [TRENDYOL SİPARİŞ CİRO],

SUM(CASE WHEN OrderTypeSourceExternalNo LIKE '%migros%' THEN 1 ELSE 0 END) [MİGROS SİPARİŞ ADET],
ROUND(SUM(CASE WHEN OrderTypeSourceExternalNo LIKE '%migros%' THEN h.AmountDue ELSE 0 END),2) [MİGROS SİPARİŞ CİRO],

SUM(CASE WHEN OrderType=5 and OrderTypeSourceExternalNo IS NULL THEN 1 ELSE 0 END) [PAKET ADET],
ROUND(SUM(CASE WHEN OrderType=5 and OrderTypeSourceExternalNo IS NULL THEN h.AmountDue ELSE 0 END),2) [PAKET CİRO]



FROM OrderHeaders AS h WITH(NOLOCK)

LEFT JOIN efr_Branchs br on br.BranchID=h.BranchID
WHERE h.LineDeleted=0
AND h.OrderDateTime>@date1
AND h.OrderDateTime<@date2
AND h.@BranchID
and h.OrderType=5
group by br.BranchName,h.BranchId,h.OrderType