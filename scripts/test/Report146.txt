DECLARE @startDate DATETIME;set @startDate=GETDATE();
IF DATEPART(hour,@startDate)<6
 set @startDate=DATEADD(dd, -1, DATEDIFF(dd, 0, @startDate))
ELSE
set @startDate=DATEADD(dd, 0, DATEDIFF(dd, 0, @startDate))

Select
  'Yüklenen Para Puan' As Tipi,
  Sum(CustomerCredits.CreditAmount) As Tutar
From
  CustomerCredits 
        Where   CustomerCredits.CreditDateTime >=@startDate and  CustomerCredits.@BranchID




UNION ALL
SELECT 'Tüketilen Para Puan' as Tipi,
  Sum(OrderHeaders.CreditAmountUsed) As Tutar
From
  (OrderHeaders Inner Join
    CustomerCredits On CustomerCredits.CreditID = OrderHeaders.CreditID)
  Inner Join
  CustomerFiles On CustomerFiles.CustomerID = CustomerCredits.CustomerID
  Where  OrderHeaders.OrderDateTime >=@startDate and  orderheaders.OrderStatus <>'3'
  and OrderHeaders.@BranchID
UNION ALL




SELECT 'Cari Hesap Tahsilat'as Tipi, sum(OnAccountPayments.AmountPaid) as Tutar
FROM  OnAccountPayments WHERE  
  OnAccountPayments.PaymentDateTime >=@startDate And OnAccountPayments.@BranchID


UNION ALL


SELECT     'Cari Hesap Satış'as Tipi, sum(OnAccountCharges.AmountCharged) as Tutar
FROM         OnAccountCharges
WHERE    OnAccountCharges.ChargeDateTime >=@startDate And OnAccountCharges.@BranchID



UNION ALL
Select 'Çek İndirimleri' as Tipi,
  Sum(orderheaders.DiscountAmountUsed) As Tutar
From
  orderheaders WHERE orderheaders.OrderDateTime >=@startDate And orderheaders.@BranchID
 AND orderheaders.OrderStatus<>'3' 



 
UNION ALL

Select 'Nakit İndirimler' as Tipi,
  Sum(orderheaders.CashDiscountAmount) As Tutar
From
  orderheaders WHERE  orderheaders.OrderDateTime >=@startDate And orderheaders.@BranchID
   AND orderheaders.OrderStatus<>'3' 


UNION ALL



SELECT 'Toplam Kasa' AS Tipi,
      SUM(OrderPayments.AmountPaid)
 AS Tutar
FROM   OrderPayments
WHERE  OrderPayments.PaymentDateTime >=@startDate 
        And OrderPayments.@BranchID

UNION ALL
SELECT 'Açık Çekler' AS Tipi,
       SUM(orderheaders.AmountDue) AS Toplam
FROM   orderheaders
WHERE  orderheaders.OrderStatus = '1'
       AND orderheaders.OrderDateTime >=@startDate 
       AND orderheaders.@BranchID

UNION ALL
SELECT     'Net Satış Tutarı' AS Tipi, SUM(orderheaders.AmountDue) AS Tutar 
FROM         orderheaders
 WHERE  orderheaders.orderdatetime >=@startDate 
                  
                  AND orderheaders.@BranchID AND orderheaders.OrderStatus<>'3'

UNION ALL
Select
  'Kasa Ödemeleri' as Tipi,
  Sum(PayOuts.PayOutAmount) As Tutar
FROM PayOuts Where PayOuts.PayOutDateTime >=@startDate And PayOuts.@BranchID


UNION ALL

SELECT 'Brut Satış Tutarı' as Tipi,
 SUM(OrderTransactions.ExtendedPrice) as Tutar
From
  OrderTransactions Inner Join
  OrderHeaders On OrderHeaders.OrderID = OrderTransactions.OrderID  and  OrderHeaders.BranchID= OrderTransactions.BranchID WHERE  
OrderHeaders.OrderDateTime >=@startDate and OrderHeaders.OrderStatus<>'3' and OrderTransactions.TransactionStatus='1' and OrderTransactions.@BranchID

