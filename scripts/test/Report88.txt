SELECT MenuItems.MenuItemID AS Kodu, MenuItems.BranchID AS [Şube Kodu], (
 SELECT TOP 1
 MenuGroups.MenuGroupText
 FROM MenuGroups
 WHERE MenuGroups.MenuGroupID = MenuItems.MenuGroupID AND MenuGroups.@BranchID
 ) AS Grubu, (
 SELECT TOP 1
 MenuCategories.MenuCategoryText
 FROM MenuCategories
 WHERE MenuCategories.MenuCategoryID = MenuItems.MenuCategoryID AND MenuCategories.@BranchID
 ) AS Kategorisi, MenuItems.MenuItemText AS Ürün, MenuItems.Barcode AS Barkod, ROUND((SUM(OrderTransactions.ExtendedPrice) / NULLIF(SUM(OrderTransactions.Quantity), 0)), 2) AS 
 [Birim Fiyat], ROUND((SUM(OrderTransactions.Quantity)), 2) AS Adet, ROUND((SUM(OrderTransactions.ExtendedPrice)), 2) AS [Satış Tutarı]
FROM (MenuItems INNER JOIN OrderTransactions ON MenuItems.MenuItemKey = OrderTransactions.MenuItemKey AND MenuItems.BranchID = OrderTransactions.BranchID)
INNER JOIN OrderHeaders ON OrderTransactions.OrderKey = OrderHeaders.OrderKey AND OrderTransactions.BranchID = OrderHeaders.BranchID
WHERE OrderHeaders.OrderDateTime <= @date1 AND OrderHeaders.OrderDateTime >= @date2 AND OrderTransactions.TransactionStatus =1 AND MenuItems.@BranchID AND 
 OrderHeaders.LineDeleted = 0
GROUP BY MenuItems.MenuItemText, MenuItems.MenuCategoryID, MenuItems.MenuGroupID, MenuItems.Barcode, MenuItems.MenuItemID, MenuItems.BranchID