Detail|
DECLARE @orderKey UNIQUEIDENTIFIER;
SET @orderKey=ISNULL((SELECT TOP 1 OrderKey FROM OrderHeaders WITH (NOLOCK) WHERE OrderID=@OrderID AND @BranchID),NEWID());
SELECT top 1000 OrderTransactions.AutoID, OrderTransactions.TransactionDateTime, OrderTransactions.TransactionID, OrderTransactions.TransactionKey, 
 OrderTransactions.OrderKey, OrderTransactions.OrderID, OrderTransactions.OrderDateTime, OrderTransactions.StationID, OrderTransactions.EmployeeID, 
 OrderTransactions.RevenueCenterTypeID, OrderTransactions.MenuItemID, OrderTransactions.MenuItemText,'' as DisplayText, OrderTransactions.MenuItemGroupText, 
 OrderTransactions.MenumItemCategoryText, OrderTransactions.MenuItemUnitPrice, OrderTransactions.MenuItemCost, OrderTransactions.Quantity, 
 OrderTransactions.ExtendedPrice, OrderTransactions.DiscountID, OrderTransactions.DiscountLineAmount, OrderTransactions.DiscountCashAmount, 
 OrderTransactions.DiscountTotalAmount, OrderTransactions.TransactionStatus, OrderTransactions.NotificationStatus, OrderTransactions.AdditionLinePrinted, 
 isnull(OrderTransactions.TaxPercent,0) as TaxPercent, OrderTransactions.Mod1ID, OrderTransactions.Mod1Cost, OrderTransactions.Mod2ID, OrderTransactions.Mod2Cost, 
 OrderTransactions.Mod3ID, OrderTransactions.Mod3Cost, OrderTransactions.Mod4ID, OrderTransactions.Mod4Cost, OrderTransactions.Mod5ID, 
 OrderTransactions.Mod5Cost, OrderTransactions.Mod6ID, OrderTransactions.Mod6Cost, OrderTransactions.Mod7ID, OrderTransactions.Mod7Cost, 
 OrderTransactions.Mod8ID, OrderTransactions.Mod8Cost, OrderTransactions.Mod9ID, OrderTransactions.Mod9Cost, OrderTransactions.Mod10ID, 
 OrderTransactions.Mod10Cost, OrderTransactions.Mod11ID, OrderTransactions.Mod11Cost, OrderTransactions.Mod12ID, OrderTransactions.Mod12Cost, 
 OrderTransactions.Mod13ID, OrderTransactions.Mod13Cost, OrderTransactions.Mod14ID, OrderTransactions.Mod14Cost, OrderTransactions.Mod15ID, 
 OrderTransactions.Mod15Cost, OrderTransactions.Mod16ID, OrderTransactions.Mod16Cost, OrderTransactions.Mod17ID, OrderTransactions.Mod17Cost, 
 OrderTransactions.Mod18ID, OrderTransactions.Mod18Cost, OrderTransactions.Mod19ID, OrderTransactions.Mod19Cost, OrderTransactions.Mod20ID, 
 OrderTransactions.Mod20Cost, OrderTransactions.SeatNumber, OrderTransactions.OnHoldUntilTime, OrderTransactions.Notes, isnull(OrderTransactions.SaleTaxAmount,0) as SaleTaxAmount, 
 OrderTransactions.UsedPrinterID1, OrderTransactions.UsedPrinterID2, OrderTransactions.UsedPrinterID3, OrderTransactions.UsedPrinterID4, 
 OrderTransactions.UsedPrinterID5, OrderTransactions.UsedPrinterComplated1, OrderTransactions.UsedPrinterComplated2, 
 OrderTransactions.UsedPrinterComplated3, OrderTransactions.UsedPrinterComplated4, OrderTransactions.UsedPrinterComplated5, OrderTransactions.LineDeleted, 
 OrderTransactions.DeleteReason, isnull(OrderTransactions.CustomField1,'') as CustomField1, OrderTransactions.CustomField2, OrderTransactions.CustomField3, 
 OrderTransactions.CustomField4, OrderTransactions.CustomField5, OrderTransactions.EditKey, OrderTransactions.SyncKey, OrderTransactions.BranchID, 
 isnull(OrderTransactions.SplitDetail,'') as SplitDetail, OrderTransactions.AddUserID, OrderTransactions.AddDateTime, OrderTransactions.EditUserID, OrderTransactions.EditDateTime, OrderTransactions.EmployeeName AS EmployeeName, 
 OrderTransactions.AddUserName AS AddEmployeeName, OrderTransactions.EditUserName AS EditEmployeeName,isnull(Discounts.DiscountText,'') as DiscountText,isnull(OrderTransactions.DiscountAmountValue,0) as DiscountAmountValue ,isnull(OrderTransactions.DiscountBasisValue,0) as DiscountBasisValue , 
 mm1.MenuModifierText AS Mod1IDtext,mm2.MenuModifierText AS Mod2IDtext,mm3.MenuModifierText AS Mod3IDtext,mm4.MenuModifierText AS Mod4IDtext,mm5.MenuModifierText AS Mod5IDtext, 
 mm6.MenuModifierText AS Mod6IDtext,mm7.MenuModifierText AS Mod7IDtext,mm8.MenuModifierText AS Mod8IDtext,mm9.MenuModifierText AS Mod9IDtext,mm10.MenuModifierText AS Mod10IDtext, 
 mm11.MenuModifierText AS Mod11IDtext,mm12.MenuModifierText AS Mod12IDtext,mm13.MenuModifierText AS Mod13IDtext,mm14.MenuModifierText AS Mod14IDtext,mm15.MenuModifierText AS Mod15IDtext, 
 mm16.MenuModifierText AS Mod16IDtext,mm17.MenuModifierText AS Mod17IDtext,mm18.MenuModifierText AS Mod18IDtext,mm19.MenuModifierText AS Mod19IDtext,mm20.MenuModifierText AS Mod20IDtext, 
isnull(OrderTransactions.EditUserName,OrderTransactions.AddUserName) AS LastEmployeeName,isnull(Discounts.DiscountBasis,0) as DiscountBasis,isnull(Discounts.DiscountAmount,0) AS DiscountApplyAmount, 
 OrderTransactions.MenuItemKey, OrderTransactions.DiscountKey,OrderTransactions.PromotionKey, isnull(Promotions.PromotionName,'') as PromotionName 
 FROM OrderTransactions WITH (NOLOCK) 
 LEFT OUTER JOIN Discounts ON OrderTransactions.DiscountKey = Discounts.DiscountKey AND OrderTransactions.BranchID = Discounts.BranchID
 LEFT OUTER JOIN MenuModifiers AS mm1 ON OrderTransactions.Mod1ID = mm1.MenuModifierID AND OrderTransactions.BranchID = mm1.BranchID
 LEFT OUTER JOIN MenuModifiers AS mm2 ON OrderTransactions.Mod2ID = mm2.MenuModifierID AND OrderTransactions.BranchID = mm2.BranchID
 LEFT OUTER JOIN MenuModifiers AS mm3 ON OrderTransactions.Mod3ID = mm3.MenuModifierID AND OrderTransactions.BranchID = mm3.BranchID 
 LEFT OUTER JOIN MenuModifiers AS mm4 ON OrderTransactions.Mod4ID = mm4.MenuModifierID AND OrderTransactions.BranchID = mm4.BranchID 
 LEFT OUTER JOIN MenuModifiers AS mm5 ON OrderTransactions.Mod5ID = mm5.MenuModifierID AND OrderTransactions.BranchID = mm5.BranchID 
 LEFT OUTER JOIN MenuModifiers AS mm6 ON OrderTransactions.Mod6ID = mm6.MenuModifierID AND OrderTransactions.BranchID = mm6.BranchID 
 LEFT OUTER JOIN MenuModifiers AS mm7 ON OrderTransactions.Mod7ID = mm7.MenuModifierID AND OrderTransactions.BranchID = mm7.BranchID
 LEFT OUTER JOIN MenuModifiers AS mm8 ON OrderTransactions.Mod8ID = mm8.MenuModifierID AND OrderTransactions.BranchID = mm8.BranchID
 LEFT OUTER JOIN MenuModifiers AS mm9 ON OrderTransactions.Mod9ID = mm9.MenuModifierID AND OrderTransactions.BranchID = mm9.BranchID
 LEFT OUTER JOIN MenuModifiers AS mm10 ON OrderTransactions.Mod10ID = mm10.MenuModifierID AND OrderTransactions.BranchID = mm10.BranchID 
 LEFT OUTER JOIN MenuModifiers AS mm11 ON OrderTransactions.Mod11ID = mm11.MenuModifierID AND OrderTransactions.BranchID = mm11.BranchID
 LEFT OUTER JOIN MenuModifiers AS mm12 ON OrderTransactions.Mod12ID = mm12.MenuModifierID AND OrderTransactions.BranchID = mm12.BranchID
 LEFT OUTER JOIN MenuModifiers AS mm13 ON OrderTransactions.Mod13ID = mm13.MenuModifierID AND OrderTransactions.BranchID = mm13.BranchID
 LEFT OUTER JOIN MenuModifiers AS mm14 ON OrderTransactions.Mod14ID = mm14.MenuModifierID AND OrderTransactions.BranchID = mm14.BranchID
 LEFT OUTER JOIN MenuModifiers AS mm15 ON OrderTransactions.Mod15ID = mm15.MenuModifierID AND OrderTransactions.BranchID = mm15.BranchID
 LEFT OUTER JOIN MenuModifiers AS mm16 ON OrderTransactions.Mod16ID = mm16.MenuModifierID AND OrderTransactions.BranchID = mm16.BranchID
 LEFT OUTER JOIN MenuModifiers AS mm17 ON OrderTransactions.Mod17ID = mm17.MenuModifierID AND OrderTransactions.BranchID = mm17.BranchID
 LEFT OUTER JOIN MenuModifiers AS mm18 ON OrderTransactions.Mod18ID = mm18.MenuModifierID AND OrderTransactions.BranchID = mm18.BranchID
 LEFT OUTER JOIN MenuModifiers AS mm19 ON OrderTransactions.Mod19ID = mm19.MenuModifierID AND OrderTransactions.BranchID = mm19.BranchID
 LEFT OUTER JOIN MenuModifiers AS mm20 ON OrderTransactions.Mod20ID = mm20.MenuModifierID AND OrderTransactions.BranchID = mm10.BranchID
 LEFT OUTER JOIN Promotions ON OrderTransactions.PromotionKey = Promotions.PromotionKey AND OrderTransactions.BranchID = Promotions.BranchID
WHERE OrderTransactions.OrderKey=@orderKey and OrderTransactions.@BranchID

$Header|
DECLARE @orderKey UNIQUEIDENTIFIER;
SET @orderKey=ISNULL((SELECT TOP 1 OrderKey FROM OrderHeaders WITH (NOLOCK) WHERE OrderID=@OrderID AND @BranchID),NEWID());
SELECT OrderHeaders.AutoID, isnull(OrderHeaders.OrderID,0) as OrderID, OrderHeaders.ReceiptNo,OrderHeaders.MainOrderKey, OrderHeaders.MainOrderID, OrderHeaders.OrderTypeSourceID, 
 OrderHeaders.OrderTypeSourceExternalNo, OrderHeaders.OrderKey, OrderHeaders.OrderDateTime, OrderHeaders.EmployeeID, OrderHeaders.StationID, 
 OrderHeaders.RevenueCenterTypeID, OrderHeaders.OrderType, OrderHeaders.DineInTableID, OrderHeaders.CustomerID, OrderHeaders.DeliveryCharge, 
 OrderHeaders.DeliveryComp, OrderHeaders.DeliveryZoneID, OrderHeaders.DriverEmployeeID, OrderHeaders.DriverDepartureTime, OrderHeaders.DriverArrivalTime, 
 OrderHeaders.OnHoldUntilTime, OrderHeaders.SalesTaxRate, OrderHeaders.DiscountID, OrderHeaders.DiscountLineAmount, OrderHeaders.DiscountOrderAmount, 
 OrderHeaders.DiscountCashAmount, OrderHeaders.DiscountTotalAmount, OrderHeaders.OrderStatus, OrderHeaders.BonusAmountUsed, 
 OrderHeaders.BonusAmountEarned, OrderHeaders.BonusID, OrderHeaders.BonusCustomerID, OrderHeaders.AmountDue, OrderHeaders.PackagerAlreadyPrinted, OrderHeaders.GuestCheckPrinted, 
 OrderHeaders.GuestCheckPrintCount, OrderHeaders.AdditionPrinted, isnull(OrderHeaders.AdditionPrintedLineCount,0) as AdditionPrintedLineCount, OrderHeaders.SurchargeID, OrderHeaders.SurchargeLineAmount, 
 OrderHeaders.SurchargeOrderAmount, OrderHeaders.SurchargeCashAmount, OrderHeaders.SurchargeTotalAmount, OrderHeaders.ComplimentaryAmount, 
 OrderHeaders.SubTotal, OrderHeaders.OrderCost, OrderHeaders.GratuityPercent, OrderHeaders.CashGratuity, OrderHeaders.SalesTaxAmount,isnull(OrderHeaders.IsProduced,0) as IsProduced, 
 OrderHeaders.DriveThruComplete, OrderHeaders.BarTabName, OrderHeaders.TableReady, OrderHeaders.GuestNumber, OrderHeaders.SpecificCustomerName, OrderHeaders.OrderPhone, 
 OrderHeaders.InvoicePrinted, OrderHeaders.FiscalPrinted ,OrderHeaders.OrderNotes, OrderHeaders.OrderExternalNotes, OrderHeaders.LineDeleted, OrderHeaders.DeleteReason, 
 OrderHeaders.CustomField1, OrderHeaders.CustomField2, OrderHeaders.CustomField3, OrderHeaders.CustomField4, OrderHeaders.CustomField5, 
 OrderHeaders.EditKey, OrderHeaders.SyncKey, OrderHeaders.BranchID, OrderHeaders.LockData, OrderHeaders.LockStationID, OrderHeaders.AddUserID, 
 OrderHeaders.AddDateTime, OrderHeaders.EditUserID, OrderHeaders.EditDateTime,OrderHeaders.EmployeeName, DineInTables.DineInTableText, 
 isnull(CustomerFiles.CustomerName,OrderHeaders.CustomerName) as CustomerName, de.FirstName AS DriverEmployeeName, OrderHeaders.AddUserName AS AddEmployeeName, OrderHeaders.EditUserName AS EditEmployeeName,'' as OrderInfo 
 ,(CASE dbo.OrderHeaders.OrderType WHEN 1 THEN 'MASA' WHEN 2 THEN 'BAR SATIŞI' WHEN 3 THEN 'AL GÖTÜR' WHEN 4 THEN 'TEZGAH SATIŞI' WHEN 5 THEN 'PAKET SATIŞI' ELSE '-' END) AS OrderTypeName 
 ,isnull(OrderHeaders.DiscountAmountValue,0.0) as DiscountAmountValue ,isnull(OrderHeaders.DiscountBasisValue,0) as DiscountBasisValue, 
 OrderHeaders.EmployeeKey, OrderHeaders.CustomerKey, OrderHeaders.DiscountKey,'' as AmountText, isnull(Discounts.DiscountText,'') AS DiscountText, 
 (CASE OrderHeaders.OrderStatus WHEN 1 THEN 'AÇIK' WHEN 2 THEN 'KAPALI' WHEN 3 THEN 'İPTAL' ELSE '-' END) AS OrderStatusName 
 ,isnull(br.BranchName,'') AS BranchName 
 FROM OrderHeaders WITH (NOLOCK) 
 LEFT OUTER JOIN DineInTables ON OrderHeaders.DineInTableID = DineInTables.DineInTableID AND OrderHeaders.BranchID = DineInTables.BranchID 
 LEFT OUTER JOIN EmployeeFiles AS de ON OrderHeaders.DriverEmployeeID = de.AutoID AND OrderHeaders.BranchID = de.BranchID
 LEFT OUTER JOIN CustomerFiles ON OrderHeaders.CustomerKey = CustomerFiles.CustomerKey AND OrderHeaders.BranchID = CustomerFiles.BranchID
 LEFT OUTER JOIN efr_Branchs AS br ON OrderHeaders.BranchID = br.BranchID 
 LEFT OUTER JOIN Discounts ON OrderHeaders.DiscountKey = Discounts.DiscountKey AND OrderHeaders.BranchID = Discounts.BranchID
WHERE OrderHeaders.OrderKey=@orderKey and OrderHeaders.@BranchID

$Payment|
DECLARE @orderKey UNIQUEIDENTIFIER;
SET @orderKey=ISNULL((SELECT TOP 1 OrderKey FROM OrderHeaders WITH (NOLOCK) WHERE OrderID=@OrderID AND @BranchID),NEWID());
SELECT OrderPayments.AutoID, OrderPayments.OrderPaymentID, OrderPayments.PaymentKey, OrderPayments.OrderID, OrderPayments.OrderKey, OrderPayments.StationID, 
 OrderPayments.CustomerID, OrderPayments.CustomerEmployeeID, OrderPayments.CouponNumber,OrderPayments.RegisterSessionID, OrderPayments.RevenueCenterTypeID, OrderPayments.PaymentDateTime, OrderPayments.EmployeeID, OrderPayments.RegisterNo, 
 OrderPayments.PaymentMethodID, OrderPayments.AmountTendered, OrderPayments.AmountPaid, OrderPayments.AmountChange, OrderPayments.ExhangeRate, 
 OrderPayments.RoundingAmount, OrderPayments.IsAccountPayment, OrderPayments.IsAccountSale, OrderPayments.CurrencyID, OrderPayments.PaymentMethodCode, OrderPayments.PaymentNotes, isnull(OrderPayments.LineDeleted,0) as LineDeleted, 
 OrderPayments.DeleteReason, OrderPayments.CustomField1, OrderPayments.CustomField2, OrderPayments.CustomField3, OrderPayments.CustomField4, 
 OrderPayments.CustomField5, OrderPayments.EditKey, OrderPayments.SyncKey, OrderPayments.BranchID, OrderPayments.AddUserID, 
 OrderPayments.AddDateTime, OrderPayments.EditUserID, OrderPayments.EditDateTime, OrderPayments.PaymentMethodName 
 ,OrderPayments.EmployeeName AS EmployeeName,OrderPayments.AddUserName AS AddEmployeeName, OrderPayments.EditUserName AS EditEmployeeName,c.CustomerName, 
 OrderPayments.CustomerKey, OrderPayments.CustomerEmployeeKey, OrderPayments.EmployeeKey,OrderPayments.PaymentMethodKey 
 FROM OrderPayments WITH (NOLOCK) 
 LEFT OUTER JOIN EmployeeFiles AS e ON OrderPayments.EmployeeID = e.EmployeeID AND OrderPayments.BranchID = e.BranchID
 LEFT OUTER JOIN CustomerFiles AS c ON OrderPayments.CustomerID = c.CustomerID AND OrderPayments.BranchID = c.BranchID
WHERE OrderPayments.OrderKey=@orderKey AND OrderPayments.@BranchID