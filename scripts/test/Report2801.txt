SELECT ISNULL(pb.BranchName, '') AS Şube,h.StartDateTime AS [Dönem Başlangıcı],h.EndDateTime AS [Hesaplanma Zamanı],ISNULL(pmc.PickValue, '') AS [Ana Kategori],ISNULL(pc.PickValue, '') AS Kategori,ISNULL(pg.PickValue, '') AS Grubu,
p.ProductCode AS [Stok Kodu],p.ProductName AS [Stok Adı],u.UnitID AS Birim,w.WarehouseName AS Depo,d.Devir AS Açılış,d.Giren AS Sevk,d.IadeGiren AS [İade Gelen],d.TransferGiren AS 
[Transfer Giren],d.UretimdenGiren AS [Üretimden Giren],(d.Giren + d.TransferGiren + d.UretimdenGiren + d.IadeGiren) AS [Toplam Giren],d.SatisCikan AS Satılan,d.IadeCikan AS [İade Çıkan],
d.TransferCikan AS [Transfer Çıkan],d.FireCikan AS [Fire Çıkan],d.UretimeCikan AS [Üretime Çıkan],d.ReceteTuketim AS [Reçete Tüketim],
(d.SatisCikan+d.ReceteTuketim + d.IadeCikan + d.UretimeCikan + d.TransferCikan+d.FireCikan) AS [Toplam Çıkan]
,d.OlmasiGereken AS [Olması Gereken], d.Sayim AS [Sayım],d.Fark AS [Fark]
 FROM PnlHeader AS h WITH (NOLOCK)
INNER JOIN PnlDetail AS d ON d.PnlKey = h.PnlKey
INNER JOIN posProducts AS p ON p.ProductID=d.ProductID
INNER JOIN posProductUnits AS u ON u.UnitID = p.UnitID
INNER JOIN posWarehouse AS w ON w.WarehouseID=h.WarehouseID
LEFT OUTER JOIN posPickList AS pg ON pg.ListID=p.GroupID
LEFT OUTER JOIN posPickList AS pc ON pc.ListID=p.CategoryID
LEFT OUTER JOIN posPickList AS pmc ON pmc.ListID=p.MainCategoryID
LEFT OUTER JOIN posBranchs AS pb ON pb.WarehouseID=h.WarehouseID
WHERE h.@BranchID
AND h.EndDateTime>=@date1
AND h.EndDateTime<=@date2