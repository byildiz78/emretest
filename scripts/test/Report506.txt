DECLARE @amountDue FLOAT;
SET @amountDue=(
SELECT round((isnull((SUM(h.AmountDue)),0.0)),2) AS reportValue
FROM OrderHeaders AS h WITH(NOLOCK)
WHERE h.OrderDateTime > @date1
AND h.OrderDateTime < @date2
AND h.@BranchID
AND h.linedeleted=0
);
SELECT round((isnull((@amountDue / nullif(SUM(t.Quantity),0)),0.0)),2) AS reportValue
FROM OrderHeaders AS h WITH(NOLOCK)
INNER JOIN OrderTransactions AS t ON t.OrderKey = h.OrderKey AND t.LineDeleted=0
INNER JOIN posProducts as m on m.ProductKey=t.MenuItemKey and m.CustomField12='TABAKLAR'
WHERE h.OrderDateTime >@date1
AND h.OrderDateTime < @date2
AND h.@BranchID
AND h.linedeleted=0