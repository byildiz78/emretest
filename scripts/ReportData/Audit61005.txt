DECLARE @ciro FLOAT;
SET @ciro=(SELECT SUM(h.AmountDue) AS reportValue
FROM OrderHeaders AS h WITH(NOLOCK)
WHERE h.OrderDateTime between @date1 and @date2
AND h.@BranchID
AND h.linedeleted=0
);

SELECT
ROUND(SUM(t.ExtendedPrice * ISNULL( h.AmountDue / NULLIF( h.SubTotal ,0)  ,0))/nullif(@ciro,0)*100,2) reportValue3
FROM OrderTransactions AS t WITH(NOLOCK)
INNER JOIN OrderHeaders AS h ON t.OrderKey = h.OrderKey 
INNER JOIN posProducts as m on m.ProductKey=t.MenuItemKey
WHERE t.OrderDateTime between @date1 and @date2 
and t.@BranchID    
AND h.linedeleted=0
AND t.LineDeleted=0
AND h.OrderType=5
AND ISNULL(m.CustomField12,'')='YAN ÜRÜNLER'