DECLARE @ciro FLOAT;
SET @ciro=(SELECT SUM(h.AmountDue+h.DiscountTotalAmount) AS reportValue
FROM OrderHeaders AS h WITH(NOLOCK)
WHERE h.OrderDateTime between @date1 and @date2
AND h.@BranchID
AND h.linedeleted=0
);


SELECT 
ROUND((SUM(t.MenuItemUnitPrice*t.Quantity)/@ciro*100),2) AS ORAN
FROM   OrderTransactions t WITH (NOLOCK)
INNER JOIN efr_Branchs ON efr_Branchs.BranchID = t.BranchID
WHERE  t.TransactionDateTime >=@date1
AND t.TransactionDateTime <=@date2
AND t.linedeleted = 1
AND TransactionStatus = 3
AND ISNULL(t.DeleteReason, '') NOT LIKE '%ayrıldı%'
AND ISNULL(t.DeleteReason, '') NOT LIKE 'ürün taşındı'
AND t.@BranchID