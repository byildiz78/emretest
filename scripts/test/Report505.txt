DECLARE @ciro FLOAT;
SET @ciro=(SELECT SUM(h.AmountDue) AS reportValue
FROM OrderHeaders AS h WITH(NOLOCK)
WHERE h.OrderDateTime >@date1
AND h.OrderDateTime < @date2
AND h.@BranchID
AND h.linedeleted=0
);

SELECT
round((ISNULL((SUM(CASE WHEN ISNULL(m.CustomField12,'')='YAN ÜRÜNLER' 
THEN ( isnull(nullif(t.ExtendedPrice,0),t.Quantity*m1.DefaultUnitPrice) /*ISNULL(((h.AmountDue/nullif(isnull(nullif(h.SubTotal,0),h.AmountDue),0))),1)*/
) ELSE 0 END)),0)/nullif(@ciro,0)*100),2) reportValue3
FROM OrderHeaders AS h WITH(NOLOCK)
INNER JOIN OrderTransactions AS t ON t.OrderKey = h.OrderKey AND t.LineDeleted=0
INNER JOIN NewGlobalMenuItems m1 ON m1.MenuItemKey = t.MenuItemKey
INNER JOIN posProducts as m on m.ProductKey=t.MenuItemKey
WHERE h.OrderDateTime>@date1 
and h.OrderDateTime<@date2 
and h.@BranchID AND (h.OrderType<>5 or h.OrderType IS NULL)
AND h.linedeleted=0;