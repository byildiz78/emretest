
SELECT t.AddUserName                 AS Personel,
       COUNT(DISTINCT h.orderkey)    AS [Çek Sayısı],
       ROUND(
           SUM(t.ExtendedPrice) / NULLIF(COUNT(DISTINCT h.orderkey), 0),
           2
       )                             AS [Çek Ort],
       SUM(h.guestnumber)            AS [Toplam Kişi],
       ROUND(SUM(t.ExtendedPrice) / NULLIF(SUM(h.guestnumber), 0), 2) AS 
       [Kişi Ort],
       SUM(t.MenuItemUnitPrice * t.Quantity) AS [Brüt Satış],
       SUM(t.DiscountTotalAmount) + SUM(DISTINCT h.DiscountOrderAmount)  AS 
       [Toplam İndirim Tutar ],
       SUM(t.MenuItemUnitPrice * t.Quantity) - SUM(t.DiscountTotalAmount) -SUM(DISTINCT h.DiscountOrderAmount) AS 
       [Net Satış]
FROM   OrderTransactions             AS t
       LEFT OUTER JOIN OrderHeaders  AS h
            ON  t.OrderKey = h.OrderKey
WHERE  t.LineDeleted = 0
       AND h.LineDeleted = 0
       AND h.OrderDateTime >= @date1
       AND h.OrderDateTime <= @date2
and t.@BranchID
and h.@BranchID
GROUP BY
       t.AddUserName   