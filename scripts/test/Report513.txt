DECLARE @ciro FLOAT;
SET @ciro=(

SELECT 
Round(SUM(CASE WHEN ISNULL(m.CustomField12,'')='PERSONEL MENÜ' THEN ISNULL(t.ExtendedPrice,(t.Quantity * m1.DefaultUnitPrice)) ELSE 0 END),2) as Ciro


FROM OrderHeaders AS h WITH(NOLOCK)
INNER JOIN OrderTransactions AS t ON t.OrderKey = h.OrderKey AND t.LineDeleted=0
INNER JOIN NewGlobalMenuItems m1 ON m1.MenuItemKey = t.MenuItemKey
INNER JOIN posProducts as m on m.ProductKey=t.MenuItemKey
WHERE h.OrderDateTime>@date1 
and h.OrderDateTime<@date2 
and h.@BranchID
AND h.linedeleted=0

);

SELECT 
@ciro as ciro,
Round(@ciro * 100 / Sum(h.amountdue),2) as Oran
FROM OrderHeaders AS h WITH(NOLOCK)
--INNER JOIN OrderTransactions AS t ON t.OrderKey = h.OrderKey AND t.LineDeleted=0
--INNER JOIN NewGlobalMenuItems m1 ON m1.MenuItemKey = t.MenuItemKey
--INNER JOIN posProducts as m on m.ProductKey=t.MenuItemKey
WHERE h.OrderDateTime>@date1 
and h.OrderDateTime<@date2 
and h.@BranchID
AND h.linedeleted=0

