SELECT SUM((CASE WHEN r.FarkDakika <1 THEN r.Quantity ELSE 0 END)) AS [< 1 DK], SUM((CASE WHEN r.FarkDakika < 5 AND r.FarkDakika >= 1 THEN r.Quantity ELSE 0 END)) AS [1-5 DK], 
 SUM((CASE WHEN r.FarkDakika <10 AND r.FarkDakika >= 5 THEN r.Quantity ELSE 0 END)) AS [5-10 DK], SUM((CASE WHEN r.FarkDakika < 15 AND r.FarkDakika >= 10 THEN r.Quantity ELSE 0 END)) AS 
 [10-15 DK], SUM((CASE WHEN r.FarkDakika < 20 AND r.FarkDakika >= 15 THEN r.Quantity ELSE 0 END)) AS [15-20 DK], SUM((CASE WHEN r.FarkDakika < 25 AND r.FarkDakika >= 20 THEN r.Quantity ELSE 0 END)) AS 
 [20-25 DK], SUM((CASE WHEN r.FarkDakika < 30 AND r.FarkDakika >= 25 THEN r.Quantity ELSE 0 END)) AS [25-30 DK], SUM((CASE WHEN r.FarkDakika < 35 AND r.FarkDakika >= 30 THEN r.Quantity ELSE 0 END)) AS 
 [30-35 DK], SUM((CASE WHEN r.FarkDakika < 40 AND r.FarkDakika >= 35 THEN r.Quantity ELSE 0 END)) AS [35-40 DK], SUM((CASE WHEN r.FarkDakika < 45 AND r.FarkDakika >= 40 THEN r.Quantity ELSE 0 END)) AS 
 [40-45 DK], SUM((CASE WHEN r.FarkDakika < 50 AND r.FarkDakika >= 45 THEN r.Quantity ELSE 0 END)) AS [45-50 DK], SUM((CASE WHEN r.FarkDakika >= 50 THEN r.Quantity ELSE 0 END)) AS 
 [> 50 DK], SUM(r.Quantity) AS [TOPLAM SAYI], ROUND((SUM(r.FarkDakika) / SUM(1.0)), 3) AS [ORTALAMA SÃœRE]
FROM (
SELECT cast(DATEDIFF(minute, TransactionDateTime, 
CAST(
case when len(isnull(CustomField5,''))<9 or isnull(CustomField5,'') not LIKE '%201%' and isnull(CustomField5,'') not LIKE '%202%' or isnull(CustomField5,'') LIKE '%t%' THEN dateadd(minute,1,TransactionDateTime) ELSE  CustomField5 END
AS DATETIME)
) AS FLOAT)/Quantity AS FarkDakika,Quantity
FROM OrderTransactions WITH (NOLOCK)
WHERE OrderTransactions.@BranchID AND OrderTransactions.Transactiondatetime >= @date1 AND OrderTransactions.Transactiondatetime <= @date2 
 AND LineDeleted = 0 
--AND OrderTransactions.MenuItemGroupText LIKE '%tava%'
) AS r
WHERE R.FarkDakika<70 AND R.FarkDakika>=1